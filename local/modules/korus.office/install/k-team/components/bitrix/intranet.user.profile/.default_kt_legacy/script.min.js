!function(){BX.ready(function(){var e=BX.UI.Hint.createInstance({popupParameters:{className:"intranet-user-profile-business-signs-hint-popup"}}),t=BX("js-business-signs-slider");null!==t&&(e.init(t),t.classList.contains("slider-mode"))&&new Glide("#js-business-signs-slider",{dragThreshold:!1,swipeThreshold:!1}).mount()});var r=BX.namespace("BX.Intranet.UserProfile");r.Manager||(r.Manager=function(e){this.init(e)},r.Manager.prototype={init:function(s){this.signedParameters=s.signedParameters,this.componentName=s.componentName,this.canEditProfile="Y"===s.canEditProfile,this.userId=s.userId||"",this.userStatus=s.userStatus||"",this.isOwnProfile="Y"===s.isOwnProfile,this.isSessionAdmin="Y"===s.isSessionAdmin,this.urls=s.urls,this.isExtranetUser="Y"===s.isExtranetUser,this.adminRightsRestricted="Y"===s.adminRightsRestricted,this.delegateAdminRightsRestricted="Y"===s.delegateAdminRightsRestricted,this.isFireUserEnabled="Y"===s.isFireUserEnabled,this.showSonetAdmin="Y"===s.showSonetAdmin,this.languageId=s.languageId,this.initialFields=s.initialFields,this.siteId=s.siteId,this.isCloud="Y"===s.isCloud,this.isRusCloud="Y"===s.isRusCloud,this.isCurrentUserIntegrator="Y"===s.isCurrentUserIntegrator,this.personalMobile=this.initialFields.PERSONAL_MOBILE,this.entityEditorInstance=new r.EntityEditor({managerInstance:this,params:s}),BX.ready(function(){this.tagsManagerInstance=new r.Tags({managerInstance:this,inputNode:document.getElementById("intranet-user-profile-tags-input"),tagsNode:document.getElementById("intranet-user-profile-tags")}),this.stressLevelManagerInstance=new r.StressLevel({managerInstance:this,options:s}),this.gratsManagerInstance=new r.Grats({managerInstance:this,options:s}),this.profilePostManagerInstance=new r.ProfilePost({managerInstance:this,options:s}),this.initAvailableActions(),this.initAvatarLoader(),this.initAppsInstall();var e,t=BX("intranet-user-profile-subordinate-more"),i=(BX.type.isDomNode(t)&&BX.bind(t,"click",function(){this.loadMoreUsers(t)}.bind(this)),BX("intranet-user-profile-manages-more")),n=(BX.type.isDomNode(t)&&BX.bind(i,"click",function(){this.loadMoreUsers(i)}.bind(this)),document.querySelector(".intranet-user-profile-bottom-controls")),o=document.getElementById("intranet-user-profile_buttons");BX.type.isDomNode(n)&&BX.type.isDomNode(o)&&((e=o.querySelector(".ui-entity-settings-link")).setAttribute("class","ui-btn ui-btn-xs ui-btn-light-border ui-btn-themes"),o.parentNode.removeChild(o),n.appendChild(e))}.bind(this))},initAvailableActions:function(){var e;this.userStatus&&(e=document.querySelector("[data-role='user-profile-actions-button']"),BX.type.isDomNode(e))&&BX.bind(e,"click",BX.proxy(function(){this.showActionPopup(BX.proxy_context)},this))},initAvatarLoader:function(){var e=new BX.AvatarEditor({enableCamera:!0});BX("intranet-user-profile-photo-camera")&&!e.isCameraEnabled()&&BX.hide(BX("intranet-user-profile-photo-camera")),BX.bind(BX("intranet-user-profile-photo-camera"),"click",function(){e.show("camera")}),BX.bind(BX("intranet-user-profile-photo-file"),"click",function(){e.show("file")}),BX.addCustomEvent(e,"onApply",BX.proxy(function(e,t){var i=new FormData;e.name||(e.name="tmp.png"),i.append("newPhoto",e,e.name),this.changePhoto(i)},this)),BX.bind(BX("intranet-user-profile-photo-remove"),"click",BX.proxy(function(){""!=BX("intranet-user-profile-photo").style.backgroundImage&&this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_PHOTO_DELETE_CONFIRM"),this.deletePhoto.bind(this))},this))},initAppsInstall:function(){var e=document.querySelector("[data-role='profile-android-app']"),e=(BX.type.isDomNode(e)&&BX.bind(e,"click",BX.proxy(function(){this.showSmsPopup(this.personalMobile)},this)),document.querySelector("[data-role='profile-ios-app']"));BX.type.isDomNode(e)&&BX.bind(e,"click",BX.proxy(function(){this.showSmsPopup(this.personalMobile)},this))},showActionPopup:function(e){var t,i=[];this.showSonetAdmin&&i.push({text:BX.message(this.isSessionAdmin?"INTRANET_USER_PROFILE_QUIT_ADMIN_MODE":"INTRANET_USER_PROFILE_ADMIN_MODE"),className:"menu-popup-no-icon",onclick:function(){this.popupWindow.close(),__SASSetAdmin()}}),"admin"===this.userStatus&&this.canEditProfile&&!this.isOwnProfile&&i.push({text:BX.message("INTRANET_USER_PROFILE_REMOVE_ADMIN_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.removeAdminRights()},this)}),"employee"!==this.userStatus||!this.canEditProfile||this.isOwnProfile||this.isCurrentUserIntegrator||(t=BX.message("INTRANET_USER_PROFILE_SET_ADMIN_RIGHTS"),this.delegateAdminRightsRestricted&&(t+="<span class='intranet-user-profile-lock-icon'></span>"),i.push({text:t,onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.adminRightsRestricted?this.delegateAdminRightsRestricted?top.BX.UI.InfoHelper.show("limit_admin_admins"):this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_MOVE_ADMIN_RIGHTS_CONFIRM"),this.setAdminRights.bind(this)):this.setAdminRights()},this)})),"admin"!==this.userStatus&&"employee"!==this.userStatus&&"integrator"!==this.userStatus&&!this.isExtranetUser||!this.canEditProfile||this.isOwnProfile||BX.util.in_array(this.userStatus,["email","shop"])||(t=BX.message("INTRANET_USER_PROFILE_FIRE"),this.isFireUserEnabled||"integrator"===this.userStatus||(t+="<span class='intranet-user-profile-lock-icon'></span>"),i.push({text:t,className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.isFireUserEnabled||"integrator"===this.userStatus?this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_FIRE_CONFIRM"),this.fireUser.bind(this)):top.BX.UI.InfoHelper.show("limit_dismiss")},this)})),"fired"===this.userStatus&&this.canEditProfile&&!this.isOwnProfile&&i.push({text:BX.message("INTRANET_USER_PROFILE_HIRE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_HIRE_CONFIRM"),this.hireUser.bind(this))},this)}),"invited"===this.userStatus&&this.canEditProfile&&!this.isOwnProfile&&(i.push({text:BX.message("INTRANET_USER_PROFILE_REINVITE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.reinviteUser()},this)}),i.push({text:BX.message("INTRANET_USER_PROFILE_DELETE"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_DELETE_CONFIRM"),this.deleteUser.bind(this))},this)})),this.isExtranetUser&&this.canEditProfile&&!this.isOwnProfile&&this.isCloud&&i.push({text:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.moveToIntranet()},this)}),this.isCloud&&this.canEditProfile&&!this.isOwnProfile&&"integrator"!==this.userStatus&&i.push({text:BX.message("INTRANET_USER_PROFILE_SET_INEGRATOR_RIGHTS"),className:"menu-popup-no-icon",onclick:BX.proxy(function(){BX.proxy_context.popupWindow.close(),this.showConfirmPopup(BX.message("INTRANET_USER_PROFILE_SET_INTEGRATOR_RIGHTS_CONFIRM"),this.setIntegratorRights.bind(this))},this)}),BX.PopupMenu.show("user-profile-action-popup",e,i,{offsetTop:0,offsetLeft:10,angle:!0,events:{onPopupClose:function(){BX.PopupMenu.destroy()}}})},showConfirmPopup:function(e,t){BX.PopupWindowManager.create({id:"intranet-user-profile-confirm-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:!1,lightShadow:!0,offsetLeft:100,overlay:!1,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(e){e.setWaiting(),this.context.close(),t()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})],events:{onPopupClose:function(){this.destroy()}}}).show()},showFireInvitedUserPopup:function(t){BX.PopupWindowManager.create({id:"intranet-user-profile-fire-invited-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.message("INTRANET_USER_PROFILE_FIRE_INVITED_USER")}),closeIcon:!0,lightShadow:!0,offsetLeft:100,overlay:!1,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_YES"),events:{click:function(e){e.setWaiting(),this.context.close(),t()}}}),new BX.UI.CancelButton({text:BX.message("INTRANET_USER_PROFILE_NO"),events:{click:function(){this.context.close()}}})]}).show()},showErrorPopup:function(e){e&&BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:e}),closeIcon:!0,lightShadow:!0,offsetLeft:100,overlay:!1,contentPadding:10}).show()},loadMoreUsers:function(e){if(BX.type.isDomNode(e)){for(var t=e.parentNode.querySelectorAll("[data-role='user-profile-item']"),i=t.length,n=0;n<4&&n<i;n++)t[n].style.display="inline-block",t[n].setAttribute("data-role","");i-4<=0?e.style.display="none":BX.findChild(e).innerHTML=i-4}},changePhoto:function(e){var t=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"loadPhoto",{signedParameters:this.signedParameters,mode:"ajax",data:e}).then(function(e){e.data&&(BX("intranet-user-profile-photo").style="background-image: url('"+e.data+"'); background-size: cover;"),this.hideLoader({loader:t})}.bind(this),function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},deletePhoto:function(){var t=this.showLoader({node:BX("intranet-user-profile-photo"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deletePhoto",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){BX("intranet-user-profile-photo").style="",this.hideLoader({loader:t})}.bind(this),function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},setAdminRights:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?(BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{}),location.reload()):(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},setIntegratorRights:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"setIntegratorRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?location.reload():(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},removeAdminRights:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"removeAdminRights",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?(BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{}),location.reload()):(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},fireUser:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"fireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?(BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{}),location.reload()):(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t}),this.showErrorPopup(e.errors[0].message)}.bind(this))},hireUser:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"hireUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?location.reload():(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t})}.bind(this))},deleteUser:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runComponentAction(this.componentName,"deleteUser",{signedParameters:this.signedParameters,mode:"ajax",data:{}}).then(function(e){!0===e.data?(BX.SidePanel.Instance.postMessageTop(window,"userProfileSlider::reloadList",{}),BX.SidePanel.Instance.close()):(this.hideLoader({loader:t}),this.showErrorPopup("Error"))},function(e){this.hideLoader({loader:t}),this.showFireInvitedUserPopup(this.fireUser.bind(this))}.bind(this))},reinviteUser:function(){var t=this.showLoader({node:BX("intranet-user-profile-wrap"),loader:null,size:100});BX.ajax.runAction("intranet.controller.invite.reinvite",{data:{params:{userId:this.userId,extranet:"Y"==this.isExtranetUser?"Y":"N"}}}).then(function(e){this.hideLoader({loader:t}),e.data.result&&BX.PopupWindowManager.create("intranet-user-profile-invited-popup",null,{content:"<p>"+BX.message("INTRANET_USER_PROFILE_REINVITE_SUCCESS")+"</p>",offsetLeft:27,offsetTop:7,autoHide:!0}).show()}.bind(this),function(e){this.hideLoader({loader:t})}.bind(this))},moveToIntranet:function(n){!0!==n&&(n=!1),BX.PopupWindowManager.create("BXExtranet2Intranet",null,{autoHide:!1,zIndex:0,offsetLeft:0,offsetTop:0,overlay:!0,draggable:{restrict:!0},closeByEsc:!0,titleBar:BX.message("INTRANET_USER_PROFILE_MOVE_TO_INTRANET_TITLE"),closeIcon:!1,width:500,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_MOVE"),events:{click:BX.proxy(function(){var i=BX.proxy_context,e=(BX.addClass(i.button,"ui-btn-wait"),BX("moveToIntranetForm"));BX.type.isDomNode(e)&&BX.ajax.runComponentAction(this.componentName,"moveToIntranet",{signedParameters:this.signedParameters,mode:"ajax",data:{departmentId:BX("toIntranetDepartment").value,isEmail:n?"Y":"N"}}).then(function(e){e.data&&(i.context.setContent(e.data),i.context.setButtons([new BX.UI.CloseButton({events:{click:function(){location.reload()}}})]))},function(e){BX.removeClass(i.button,"ui-btn-wait");var t=BX("moveToIntranetForm");BX.type.isDomNode(t)&&!BX("moveToIntranetError")&&(e=BX.create("div",{attrs:{id:"moveToIntranetError",class:"ui-alert ui-alert-danger ui-alert-icon-danger"},children:[BX.create("span",{attrs:{class:"ui-alert-message"},html:e.errors[0].message})]}),t.insertBefore(e,BX.findChild(t)))}.bind(this))},this)}}),new BX.UI.CancelButton({events:{click:function(){this.context.close()}}})],events:{onAfterPopupShow:BX.proxy(function(){var t=BX.proxy_context,i=(t.setContent('<div style="width:450px;height:230px"></div>'),this.showLoader({node:t.contentContainer,loader:null,size:100}));BX.ajax.post("/bitrix/tools/b24_extranet2intranet.php",{USER_ID:this.userId,IS_EMAIL:n?"Y":"N"},BX.proxy(function(e){this.hideLoader({loader:i}),t.setContent(e)},this))},this)}}).show()},showLoader:function(e){var t=null;return e.node&&(t=null===e.loader?new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40}):e.loader).show(),t},hideLoader:function(e){null!==e.loader&&e.loader.hide(),e.node&&BX.cleanNode(e.node),null!==e.loader&&(e.loader=null)},processSliderCloseEvent:function(i){BX.addCustomEvent("SidePanel.Slider:onMessage",function(e){var t;e.getSlider()==BX.SidePanel.Instance.getSliderByWindow(window)&&"SidePanel.Wrapper:onClose"==e.getEventId()&&(e=e.getData(),BX.type.isNotEmptyObject(e.sliderData))&&(t=e.sliderData.get("entityType"),e=e.sliderData.get("entityId"),BX.type.isNotEmptyString(t))&&t==i.entityType&&e==this.userId&&i.callback()}.bind(this))},showSmsPopup:function(i){BX.PopupWindowManager.create({id:"intranet-user-profile-sms-popup",className:"intranet-user-profile-popup",titleBar:BX.message("INTRANET_USER_PROFILE_APP_INSTALL"),maxWidth:450,contentColor:"white",content:BX.create("div",{children:[BX.create("div",{props:{className:"intranet-user-profile-popup-title"},html:BX.message("INTRANET_USER_PROFILE_APP_PHONE")}),BX.create("div",{props:{className:"ui-ctl ui-ctl-textbox ui-ctl-wa"},children:[BX.create("input",{props:{value:i,className:"ui-ctl-element",type:"text"},events:{input:function(){i=this.value}}})]}),BX.create("div",{props:{className:"intranet-user-profile-popup-text"},html:BX.message("INTRANET_USER_PROFILE_APP_INSTALL_TEXT")})]}),closeIcon:!0,contentPadding:10,buttons:[new BX.UI.CreateButton({text:BX.message("INTRANET_USER_PROFILE_APP_SEND"),className:"ui-btn-primary",events:{click:BX.proxy(function(e){e.setWaiting();var t=e.context;BX.ajax.runAction("intranet.controller.sms.sendsmsforapp",{data:{phone:i}}).then(function(e){t.close()}.bind(this),function(e){t.close()}.bind(this))},this)}})],events:{onPopupClose:function(){this.destroy()}}}).show()}},$(function(){phonePersonalEdit()}))}();let phonePersonalEdit=function(){mainBlock$=$(".wrap-edit-fields-js"),0<(block$=$('.wrap-edit-fields-js .ui-entity-editor-content-block[data-cid="UF_MOB_PHONE_PER"]')).length&&$(document).on("click",".phone-block-icon",function(){let t=0<parseInt(mainBlock$.attr("data-phone-visible"),10)?0:1;$.post("",{action:"changePhoneVisibility",visibility:t},function(e){mainBlock$.attr("data-phone-visible",t).toggleClass("phone-not-visible")})})};