!function(){var t=BX.namespace("BX.Intranet.UserProfile");t.TagsUsersPopup||(t.TagsUsersPopup=function(t){return setTimeout(function(){this.init(t)}.bind(this),0),this},t.TagsUsersPopup.prototype={init:function(t){this.tagsInstance=t.tagsInstance,this.managerInstance=this.tagsInstance.managerInstance,this.tagNode=BX.type.isDomNode(t.tagNode)?t.tagNode:null,this.tag=t.tag,this.checksum=t.checksum,this.page=1,this.contentNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-popup"},!0,!1):null,this.actionNode=BX(t.containerNodeId)?BX.findChild(BX(t.containerNodeId),{tagName:"span",className:"iup-tags-item-users-action"},!0,!1):null,this.popup=null,this.initialized=!1,this.showPopupTimeoutId=null,this.hidePopupTimeoutId=null,this.leavePopupTimeoutId=null,this.popupUsersShownIdList=[],BX.bind(this.actionNode,"click",function(){this.tagsInstance.addTag({userId:BX.message("USER_ID"),tag:this.tag,tagNode:this.tagNode}),this.tagsInstance.reindexUser({userId:BX.message("USER_ID")}),this.popup.close()}.bind(this))},onMouseOver:function(t){this.tagsInstance.popupContent&&BX.findParent(t.event.target,{className:"intranet-user-profile-tags-popup-empty-cont"},this.tagsInstance.popupContent)||(null!==this.popup&&this.popup.isShown()?clearTimeout(this.hidePopupTimeoutId):(clearTimeout(this.showPopupTimeoutId),this.showPopupTimeoutId=setTimeout(function(){this.show({bindNode:t.event.target})}.bind(this),400)))},onMouseOut:function(t){clearTimeout(this.showPopupTimeoutId),this.popup&&(this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3))},onClick:function(t){clearTimeout(this.showPopupTimeoutId),this.show({bindNode:t.event.currentTarget})},show:function(t){this.open({bindNode:t.bindNode}),this.initialized||(this.page=1,BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){this.buildContent(t.data),this.initialized=!0}.bind(this),function(t){}.bind(this)))},open:function(t){null==this.popup&&(this.popup=new BX.PopupWindow("tags-users-popup-"+this.checksum,t.bindNode,{lightShadow:!0,offsetLeft:-22,autoHide:!0,closeByEsc:!0,zIndex:2005,bindOptions:{position:"top"},animationOptions:{show:{type:"opacity-transform"},close:{type:"opacity"}},events:{onPopupClose:function(){},onPopupDestroy:function(){}},content:BX("iup-tags-item-users-popup-container-"+this.checksum),className:"iup-tags-users-popup"}),BX.bind(BX("tags-users-popup-"+this.checksum),"mouseleave",function(){clearTimeout(this.hidePopupTimeoutId),this.hidePopupTimeoutId=setTimeout(function(){this.popup.close()}.bind(this),1e3)}.bind(this)),BX.bind(BX("tags-users-popup-"+this.checksum),"mouseenter",function(){clearTimeout(this.hidePopupTimeoutId)}.bind(this))),this.popup.show(),this.adjustPopup()},adjustPopup:function(){null!=this.popup&&(this.popup.bindOptions.forceBindPosition=!0,this.popup.adjustPosition(),this.popup.bindOptions.forceBindPosition=!1)},buildContent:function(t){if(BX.type.isArray(t.USERS)){1==this.page&&this.contentNode&&(this.contentNode.innerHTML=""),this.page+=1;for(var i=null,s=0;s<t.USERS.length;s++)BX.util.in_array(t.USERS[s].ID,this.popupUsersShownIdList)||(this.popupUsersShownIdList.push(t.USERS[s].ID),i=0<t.USERS[s].PERSONAL_PHOTO.SRC.length?BX.create("IMG",{attrs:{src:t.USERS[s].PERSONAL_PHOTO.SRC},props:{className:"iup-tags-item-users-popup-avatar-img"}}):BX.create("IMG",{attrs:{src:"/bitrix/images/main/blank.gif"},props:{className:"iup-tags-item-users-popup-avatar-img bx-contentview-popup-avatar-img-default"}}),this.contentNode.appendChild(BX.create("A",{attrs:{href:t.USERS[s].URL,target:"_blank",title:t.USERS[s].NAME_FORMATTED},props:{className:"iup-tags-item-users-popup-img"+(t.USERS[s].TYPE?" iup-tags-item-users-popup-img-"+t.USERS[s].TYPE:"")},children:[BX.create("SPAN",{props:{className:"iup-tags-item-users-popup-avatar-new"},children:[i,BX.create("SPAN",{props:{className:"bx-contentview-popup-avatar-status-icon"}})]}),BX.create("SPAN",{attrs:{"bx-tooltip-user-id":t.USERS[s].ID},props:{className:"iup-tags-item-users-popup-name-new"},html:t.USERS[s].NAME_FORMATTED})]})));this.adjustPopup(),this.bindScroll()}BX.type.isNotEmptyString(t.CAN_ADD)&&"Y"==t.CAN_ADD?this.actionNode.classList.add("iup-tags-item-users-action-visible"):this.actionNode.classList.remove("iup-tags-item-users-action-visible")},bindScroll:function(){BX.bind(this.contentNode,"scroll",function(t){t=t.currentTarget;t.scrollTop>(t.scrollHeight-t.offsetHeight)/1.5&&(BX.ajax.runComponentAction(this.managerInstance.componentName,"getTagData",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{tag:this.tag,page:this.page}}}).then(function(t){BX.type.isArray(t.data.USERS)&&0<t.data.USERS.length&&this.buildContent(t.data)}.bind(this),function(t){}.bind(this)),BX.unbindAll(t))}.bind(this))}})}();