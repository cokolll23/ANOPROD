!function(){var e=BX.namespace("BX.Intranet.UserProfile");e.Grats||(e.Grats=function(e){this.init(e)},e.Grats.prototype={init:function(e){this.managerInstance=e.managerInstance,this.options=e.options,this.initBadges(this.options.badgesData),this.postListPageSize=parseInt(this.options.gratPostListPageSize),this.postListPageNum=1,this.loader=null,this.badgesWrapperNode=BX("intranet-user-profile-thanks"),this.postsWrapperNode=BX("intranet-user-profile-thanks-users-wrapper"),this.moreLinkNode=BX("intranet-user-profile-load-users-link"),this.loaderNode=BX("intranet-user-profile-thanks-users-loader"),this.classes={item:"intranet-user-profile-thanks-item",itemActive:"intranet-user-profile-thanks-item-active",itemCounter:"intranet-user-profile-thanks-item-counter",badgesDisabled:"intranet-user-profile-thanks-disabled"},this.moreLinkNode&&BX.bind(this.moreLinkNode,"click",function(){this.getData()}.bind(this)),this.getData(),this.managerInstance.processSliderCloseEvent({entityType:"gratPost",callback:function(){BX.cleanNode(this.postsWrapperNode),this.postListPageNum=1,this.getData()}.bind(this)}),this.badgesWrapperNode&&BX.bind(this.badgesWrapperNode,"click",function(e){this.openGratSlider(e)}.bind(this))},initBadges:function(e){for(var t in this.badgesData={},e)e.hasOwnProperty(t)&&(this.badgesData[e[t].ID]={CODE:e[t].CODE,NAME:e[t].NAME})},showMoreLink:function(){this.moreLinkNode&&(this.moreLinkNode.style.display="block")},hideMoreLink:function(){this.moreLinkNode&&(this.moreLinkNode.style.display="none")},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader}),this.showBadgesLoader(),BX.ajax.runComponentAction(this.managerInstance.componentName,"getGratitudePostList",{mode:"class",signedParameters:this.managerInstance.signedParameters,data:{params:{pageSize:this.postListPageSize,pageNum:this.postListPageNum}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader}),this.hideBadgesLoader(),BX.type.isNotEmptyObject(e.data)&&(void 0!==e.data.POSTS_COUNT&&this.postListPageSize*this.postListPageNum>=parseInt(e.data.POSTS_COUNT)?this.hideMoreLink():this.showMoreLink(),this.showData(e.data),this.postListPageNum++)}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader}),this.hideBadgesLoader(),this.showMoreLink()}.bind(this))},showData:function(e){BX.type.isNotEmptyObject(e)&&(BX.type.isNotEmptyObject(e.BADGES)&&this.showBadges(e.BADGES),BX.type.isNotEmptyObject(e.POSTS))&&this.showPosts(e.POSTS,BX.type.isNotEmptyObject(e.AUTHORS)?e.AUTHORS:{})},showBadges:function(e){if(this.badgesWrapperNode){var t=BX.findChildren(this.badgesWrapperNode,{className:this.classes.item});if(t){for(var s,a=0;a<t.length;a++)s=t[a].getAttribute("data-bx-grat-enum"),BX.type.isNotEmptyString(s)&&BX.type.isNotEmptyObject(e[s])&&void 0!==e[s].COUNT&&0<parseInt(e[s].COUNT)?(t[a].appendChild(BX.create("DIV",{props:{className:this.classes.itemCounter},text:parseInt(e[s].COUNT)})),t[a].classList.add(this.classes.itemActive)):(BX.cleanNode(t[a]),t[a].classList.remove(this.classes.itemActive));var i=BX.clone(t);for(i.sort(function(e,t){return e.classList.contains(this.classes.itemActive)&&!t.classList.contains(this.classes.itemActive)?-1:!e.classList.contains(this.classes.itemActive)&&t.classList.contains(this.classes.itemActive)?1:0}.bind(this)),BX.cleanNode(this.badgesWrapperNode),a=0;a<i.length;a++)this.badgesWrapperNode.appendChild(i[a])}}},showBadgesLoader:function(){this.badgesWrapperNode&&this.badgesWrapperNode.classList.add(this.classes.badgesDisabled)},hideBadgesLoader:function(){this.badgesWrapperNode&&this.badgesWrapperNode.classList.remove(this.classes.badgesDisabled)},showPosts:function(e,t){if(this.postsWrapperNode){var s,a=null,i=null,r=null,n=[];for(s in e)e.hasOwnProperty(s)&&n.push(e[s]);n.sort(function(e,t){return e.DATE_PUBLISH_TS==t.DATE_PUBLISH_TS?0:e.DATE_PUBLISH_TS<t.DATE_PUBLISH_TS?1:-1});for(var o=0;o<n.length;o++){if(a=n[o],i=BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-likes"},children:[]}),BX.type.isNotEmptyObject(a.RATING_DATA)){if(r=BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-emodji"}}),BX.type.isNotEmptyObject(a.RATING_DATA.REACTIONS_LIST))for(var p in a.RATING_DATA.REACTIONS_LIST)!a.RATING_DATA.REACTIONS_LIST.hasOwnProperty(p)||parseInt(a.RATING_DATA.REACTIONS_LIST[p])<=0||r.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-emoji intranet-user-profile-thanks-emoji-"+p}}));i.appendChild(r),void 0!==a.RATING_DATA.TOTAL_POSITIVE_VOTES&&0<parseInt(a.RATING_DATA.TOTAL_POSITIVE_VOTES)&&i.appendChild(BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-likes-counter"},text:parseInt(a.RATING_DATA.TOTAL_POSITIVE_VOTES)}))}var d="",h="";void 0!==a.AUTHOR_ID&&0<parseInt(a.AUTHOR_ID)&&BX.type.isNotEmptyObject(t)&&BX.type.isNotEmptyObject(t[a.AUTHOR_ID])&&BX.type.isNotEmptyString(t[a.AUTHOR_ID].PHOTO)&&(d="background-size: cover; background-image: url('"+t[a.AUTHOR_ID].PHOTO+"')",h=t[a.AUTHOR_ID].NAME+" "+t[a.AUTHOR_ID].LAST_NAME),this.postsWrapperNode.appendChild(BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user"},children:[BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-avatar"},children:[BX.create("A",{attrs:{href:t[a.AUTHOR_ID].URL,"bx-tooltip-user-id":a.AUTHOR_ID},props:{className:"ui-icon ui-icon-common-user intranet-user-profile-thanks-user-userpic"},children:[BX.create("i",{props:{style:d},attrs:{title:h}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-picture"+(this.badgesData[a.BADGE_ID]?" intranet-user-profile-thanks-item-"+this.badgesData[a.BADGE_ID].CODE:"")}})]}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content"},children:[BX.create("A",{attrs:{"bx-post-url":a.URL+(-1==a.URL.indexOf("?")?"?":"&")+"IFRAME=Y",href:"#"},props:{className:"intranet-user-profile-thanks-user-content-title"},text:a.TITLE,events:{click:function(e){BX.SidePanel.Instance.open(e.currentTarget.getAttribute("bx-post-url"),{width:1e3}),e.stopPropagation(),e.preventDefault()}}}),BX.create("DIV",{props:{className:"intranet-user-profile-thanks-user-content-info"},children:[BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-date"},text:BX.type.isNotEmptyString(a.DATE_FORMATTED)?a.DATE_FORMATTED:""}),void 0!==a.CONTENT_VIEW_CNT&&0<parseInt(a.CONTENT_VIEW_CNT)?BX.create("SPAN",{props:{className:"intranet-user-profile-thanks-user-content-views"},text:a.CONTENT_VIEW_CNT}):null,i]})]})]}))}}},openGratSlider:function(e){var t,s;this.badgesWrapperNode&&(t=this.badgesWrapperNode.getAttribute("data-bx-grat-url"),BX.type.isNotEmptyString(t))&&(s=null,s=(s=e.target.classList.contains(this.classes.item)?e.target:s)||BX.findParent(e.target,{className:"intranet-user-profile-thanks-item"},this.badgesWrapperNode))&&(e=s.getAttribute("data-bx-grat-code"),BX.type.isNotEmptyString(e))&&(t+=(-1==t.indexOf("?")?"?":"&")+"gratUserId="+this.managerInstance.userId+"&gratCode="+e,BX.SidePanel.Instance.open(t,{cacheable:!1,data:{entityType:"gratPost",entityId:this.managerInstance.userId},width:1e3}))}})}();