!function(){var e=BX.namespace("BX.Intranet.UserProfile");e.StressLevel||(e.StressLevel=function(e){this.init(e)},e.StressLevel.prototype={init:function(e){this.managerInstance=e.managerInstance,this.options=e.options,this.loader=null,this.stressLevel={value:null,type:null,typeDescription:null,comment:null,hash:null},this.noResultNode=BX("intranet-user-profile-stresslevel-noresult"),this.resultNode=BX("intranet-user-profile-stresslevel-result"),this.resultNode&&this.noResultNode&&(this.resultStatusInfoNode=BX("intranet-user-profile-stresslevel-status-info"),this.permsOpenNode=BX("intranet-user-profile-stresslevel-result-perms-open"),this.permsCloseNode=BX("intranet-user-profile-stresslevel-result-perms-close"),this.checkNode=BX("intranet-user-profile-stresslevel-check"),this.widgetNode=BX("intranet-user-profile-stresslevel-widget"),this.widgetNoResultNode=BX("intranet-user-profile-stresslevel-noresult-widget"),this.resultCommentNode=BX("intranet-user-profile-stresslevel-comment"),this.resultCopyLinkNode=BX("intranet-user-profile-stresslevel-status-copy"),this.widgetLayout={container:null,arrow:null,level:null,content:null,title:null,progress:null},this.url={},this.measurementId=null,this.classes={widget:"intranet-stress-level-widget",widgetArrow:"intranet-stress-level-widget-arrow",widgetContent:"intranet-stress-level-widget-content",widgetContentTitle:"intranet-stress-level-widget-content-title",widgetContentProgress:"intranet-stress-level-widget-content-progress",widgetContentProgressEmpty:"intranet-stress-level-widget-content-progress-empty"},BX.UI.Hint.init(this.noResultNode),BX.UI.Hint.init(this.resultNode),this.getData(),this.managerInstance.canEditProfile&&this.getOpenPerms(),BX.bind(this.permsOpenNode,"click",function(){this.setOpenPerms({value:!0})}.bind(this)),BX.bind(this.permsCloseNode,"click",function(){this.setOpenPerms({value:!1})}.bind(this)),BX.bind(this.checkNode,"click",function(){this.openSlider({page:""})}.bind(this)),BX.bind(this.resultStatusInfoNode,"click",function(){this.openSlider({page:"result"})}.bind(this)),this.resultCopyLinkNode)&&((e=navigator.userAgent.match(/chrome\/(\d+)/i))&&76<=parseInt(e[1])?BX.bind(this.resultCopyLinkNode,"click",function(){this.measurementId&&this.copyToBuffer()}.bind(this)):this.resultCopyLinkNode.style.display="none")},getData:function(){this.loader=this.managerInstance.showLoader({node:this.loaderNode,loader:this.loader}),BX.ajax.runAction("socialnetwork.api.user.stresslevel.get",{signedParameters:this.managerInstance.signedParameters,data:{c:"bitrix:intranet.user.profile",fields:{userId:this.managerInstance.userId}}}).then(function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader}),BX.type.isNotEmptyObject(e.data)&&BX.type.isNotEmptyObject(e.data.url)&&(this.url=e.data.url),BX.type.isNotEmptyObject(e.data)&&void 0!==e.data.id&&(this.measurementId=parseInt(e.data.id)),BX.type.isNotEmptyObject(e.data)&&void 0!==e.data.value?this.showData(e.data):BX.message("USER_ID")==this.managerInstance.userId&&this.showEmpty()}.bind(this),function(e){this.managerInstance.hideLoader({node:this.loaderNode,loader:this.loader})}.bind(this))},showData:function(e){BX.type.isNotEmptyObject(e)&&void 0!==e.value&&(this.noResultNode&&(this.resultNode.style.display="none"),this.resultNode)&&(this.stressLevel.value=0<parseInt(e.value)?parseInt(e.value):0,this.stressLevel.comment=BX.type.isNotEmptyString(e.comment)?e.comment:"",this.stressLevel.type=BX.type.isNotEmptyString(e.type)?e.type:"",this.stressLevel.typeDescription=BX.type.isNotEmptyString(e.typeDescription)?e.typeDescription:"",this.stressLevel.hash=BX.type.isNotEmptyString(e.hash)?e.hash:"",this.resultNode.style.display="block",this.renderData())},showEmpty:function(){this.noResultNode&&(this.noResultNode.style.display="block"),this.resultNode&&(this.resultNode.style.display="none"),this.renderEmptyData()},getOpenPerms:function(){BX.ajax.runAction("socialnetwork.api.user.stresslevel.getaccess",{data:{fields:{userId:this.managerInstance.userId}}}).then(function(e){BX.type.isNotEmptyObject(e.data)&&this.showOpenPerms(e.data.value)}.bind(this),function(e){}.bind(this))},setOpenPerms:function(e){BX.type.isNotEmptyObject(e)||(e={}),BX.type.isBoolean(e.value)||(e.value=!1),BX.ajax.runAction("socialnetwork.api.user.stresslevel.setaccess",{data:{fields:{userId:this.managerInstance.userId,value:e.value?"Y":"N"}}}).then(function(e){BX.type.isNotEmptyString(e.data.value)&&this.showOpenPerms(e.data.value)}.bind(this),function(e){}.bind(this))},showOpenPerms:function(e){"Y"==e?(this.permsCloseNode.style.display="block",this.permsOpenNode.style.display="none"):(this.permsCloseNode.style.display="none",this.permsOpenNode.style.display="block")},openSlider:function(e){var t="";"result"==(BX.type.isNotEmptyObject(e)&&BX.type.isNotEmptyString(e.page)?e.page:"")&&BX.type.isNotEmptyString(this.url.result)?t=this.url.result:BX.type.isNotEmptyString(this.url.check)&&(t=this.url.check),BX.type.isNotEmptyString(t)&&BX.SidePanel.Instance.open(t,{cacheable:!1,data:{},width:500})},renderData:function(){this.widgetNode&&(this.widgetNode.appendChild(this.getRenderContainer()),this.afterRender(),this.resultCommentNode&&BX.type.isNotEmptyString(this.stressLevel.comment)&&(this.resultCommentNode.innerHTML=BX.util.htmlspecialchars(this.stressLevel.comment)),BX.type.isNotEmptyString(this.stressLevel.type))&&BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type)&&(BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).style.display="inline-block",BX("intranet-user-profile-stresslevel-status-"+this.stressLevel.type).innerHTML=BX.util.htmlspecialchars(this.stressLevel.typeDescription))},renderEmptyData:function(){this.widgetNoResultNode&&(this.widgetNoResultNode.appendChild(this.getRenderContainer()),this.afterRender())},getRenderContainer:function(){return this.widgetLayout.container||(this.widgetLayout.container=BX.create("DIV",{props:{className:this.classes.widget},children:[this.getRenderArrowContainer(),this.getRenderContentContainer()]})),this.widgetLayout.container},getRenderArrowContainer:function(){return this.widgetLayout.arrow||(this.widgetLayout.arrow=BX.create("DIV",{props:{className:this.classes.widgetArrow}})),this.widgetLayout.arrow},getRenderContentContainer:function(){return this.widgetLayout.content||(this.widgetLayout.content=BX.create("DIV",{props:{className:this.classes.widgetContent},children:[this.widgetLayout.title=BX.create("DIV",{props:{className:this.classes.widgetContentTitle},text:BX.message("INTRANET_USER_PROFILE_STRESSLEVEL_NORESULT_INDICATOR_TEXT")}),this.widgetLayout.progress=BX.create("DIV",{props:{className:this.classes.widgetContentProgress},text:"?"})]})),this.widgetLayout.content},afterRender:function(){this.stressLevel.value?setTimeout(function(){this.animateRenderNumber(),this.getRenderArrowContainer().style.transform="rotate("+this.getRenderProgressScale()+"deg)"}.bind(this),1e3):(this.widgetLayout.progress.classList.add(this.classes.widgetContentProgressEmpty),this.getRenderArrowContainer().style.transform="rotate(90deg)")},animateRenderNumber:function(){var e=0,t=600/this.stressLevel.value,s=setInterval(function(){e++,(this.widgetLayout.progress.innerHTML=e)===this.stressLevel.value&&clearInterval(s)}.bind(this),t)},getRenderProgressScale:function(){return 1.8*this.stressLevel.value},copyToBuffer:function(){this.measurementId&&fetch("/bitrix/components/bitrix/intranet.user.profile/stresslevel_img.php").then(function(e){return e.blob()}).then(function(e){navigator.clipboard.write([new ClipboardItem(Object.defineProperty({},e.type,{value:e,enumerable:!0}))])}).catch(function(e){})}})}();