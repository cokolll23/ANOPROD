import{L as ue,M as le,aM as ne,N as w,Y as re,r as s,x as _,R as ie,e as l,z as C,S as y,V as o,y as $,W as P,aw as R,ax as L,$ as me,aD as ce,c7 as de}from"./index.a1748043.js";import{u as pe,c as U,a as fe}from"./useChanges.ef424401.js";import{d as q,_ as h,q as ve}from"./KtViewCounter.d7f8eb76.js";import"./KtContactEditMessengers.e7b8855c.js";import _e from"./KtContactEditSettings.4c91d7b3.js";import{_ as x}from"./KtContactEditTable.591645fc.js";import"./KtContactEditTimezone.e93666d7.js";import"./KtContactWorkplace.ee3f3fbb.js";import"./KtContactTable.6889acca.js";import"./KtContactTableSkeleton.50b3f49f.js";import"./KtContactVisibilitySwitcherBtn.03366610.js";import"./KtContactEditWorkplace.d7420246.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.cb8db555.js";import"./vue-i18n.esm-bundler.e5a16dbd.js";import"./index.2f026771.js";import"./QBtnDropdown.41a9457c.js";import"./QMenu.8a4718ad.js";import"./QDate.59abae0b.js";import"./use-render-cache.3aae9b27.js";import"./ClosePopup.034ffd88.js";import"./QScrollArea.ec251a08.js";import"./QResizeObserver.988c698f.js";import"./QScrollObserver.bf79761e.js";import"./touch.9135741d.js";import"./QItemLabel.b302d2e1.js";import"./QTabs.a9c1b64a.js";import"./rtl.276c3f1b.js";import"./QExpansionItem.ec578cd9.js";import"./QImg.7d3e6d1d.js";import"./IndexPage.75cfb3f1.js";import"./QPagination.de182206.js";import"./QSelect.1740ff4d.js";import"./QChip.2708c0c7.js";import"./QSkeleton.d8507126.js";import"./QTabPanels.aa3c86a4.js";import"./index.43b0bc22.js";import"./_commonjsHelpers.2cf1d77b.js";const ge={class:"kt-personal-contacts-edit-mode"},Ee={class:"kt-personal-contacts-edit-mode__section"},be={class:"kt-personal-contacts-edit-mode__section"},Fe={class:"kt-personal-contacts-edit-mode__actions"},lt=ue({__name:"KtPersonalInfoEditMode",emits:["change-mode"],setup(Se,{emit:Y}){const Z=le(),z=Y,N=ne(),{SHOW_SONET_ADMIN:m,SORT_DISABLE:c}=w(re()),{FIELDS_EDITABLE:K}=w(N),{getComponentName:V,getComponentProps:k,getComponentValue:j,getComponentPreselectedValue:W}=pe(),{getChangedFields:T}=fe(),H=["NAME","LAST_NAME","SECOND_NAME"],r=s([]),i=s([]),M=s(""),g=s(null),E=s(!1),d=s(!1),p=s(!0),b=s(!1),F=s(c.value),A=s(!1),S=s(!1);Q(),G();function I(a){return K.value.filter(e=>e.sort.type===a).map(e=>Object.assign(e,j(e),W(e))).sort((e,t)=>e.sort.value>t.sort.value?1:e.sort.value<t.sort.value?-1:0)}function Q(){r.value=I("M"),i.value=I("A")}function G(){M.value=H.map(a=>`.kt-contact-edit-field--${a.toLowerCase()}`).join(", ")}async function J(){var a,e;if(p.value=Boolean(await((e=(a=g.value)==null?void 0:a.qFormRef)==null?void 0:e.validate())),!p.value)return Z.notify({type:"negative",message:"\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u0435\u0439",position:"top"}),!1;m.value?ae():D()}function X(a){F.value=a.disableSort,A.value=a.updateDefault,D()}async function D(){const a=T(r.value).concat(T(i.value));E.value=!d.value;try{await N.submit(te(a))}finally{E.value=!1}B()}async function ee(){S.value=!0,d.value=!0,O();try{await D()}finally{S.value=!1,d.value=!1}}function B(){O(),z("change-mode","read"),window.scrollTo(0,0)}function O(){var a,e;r.value.forEach(t=>{t.value=U(t.valueInitial)}),i.value.forEach(t=>{t.value=U(t.valueInitial)}),(e=(a=g.value)==null?void 0:a.qFormRef)==null||e.resetValidation(),p.value=!0}function te(a){const e=new FormData;return r.value.forEach((t,u)=>{e.set(`sortSettings[main][${t.name}]`,String(u))}),i.value.forEach((t,u)=>{e.set(`sortSettings[additional][${t.name}]`,String(u))}),e.set("sortSettings[disableSort]",F.value?"Y":"N"),e.set("sortSettings[setFromDefault]",S.value?"Y":"N"),e.set("sortSettings[updateDefault]",A.value?"Y":"N"),ce(a)||a.forEach(t=>{const u=`data[${t.name}]`,n=t.changes;switch(de(t)){case"messengers":n.length>0?n.forEach((f,v)=>{const oe=`${u}[${v}][messenger]`,se=`${u}[${v}][value]`;e.append(oe,f.messenger),e.append(se,f.value)}):e.set(`${u}[]`,"");break;case"timezone":e.set("data[AUTO_TIME_ZONE]",n.AUTO_TIME_ZONE),e.set("data[TIME_ZONE]",n.TIME_ZONE);break;case"list":e.set(u,n);break;case"multilist":n.forEach((f,v)=>{e.append(`${u}[${v}]`,String(f))});break;default:e.set(u,n)}}),e}function ae(){b.value=!0}return(a,e)=>(_(),ie("div",ge,[l(o(ve),{ref_key:"formRef",ref:g,onSubmit:J},{default:C(()=>[y("section",Ee,[l(o(q),{level:2,text:"\u041E\u0441\u043D\u043E\u0432\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F"}),l(o(x),{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),filter:M.value,"sort-disabled":o(c)&&!o(m)},{value:C(({row:t})=>[(_(),$(P(o(V)(t)),R(L(o(k)(t))),null,16))]),_:1},8,["modelValue","filter","sort-disabled"])]),y("section",be,[l(o(q),{level:2,text:"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F"}),l(o(x),{modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value=t),"sort-disabled":o(c)&&!o(m)},{value:C(({row:t})=>[(_(),$(P(o(V)(t)),R(L(o(k)(t))),null,16))]),_:1},8,["modelValue","sort-disabled"])]),y("footer",Fe,[l(o(h),{theme:"ghost",label:a.$t("common.btn.cancel"),onClick:B},null,8,["label"]),!o(c)||o(m)?(_(),$(o(h),{key:0,theme:"tertiary",label:a.$t("common.btn.restore"),loading:d.value,onClick:ee},null,8,["label","loading"])):me("",!0),l(o(h),{theme:"primary",type:"submit",label:a.$t("common.btn.save"),loading:E.value,disable:!p.value},null,8,["label","loading","disable"])])]),_:1},512),l(o(_e),{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),"disable-sort":F.value,onSubmit:X},null,8,["modelValue","disable-sort"])]))}});export{lt as default};
