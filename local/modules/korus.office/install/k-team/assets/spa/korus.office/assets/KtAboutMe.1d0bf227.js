import{L as q,X as z,N as $,Y as J,c as r,r as i,w as Q,Z as S,x as w,y as F,aF as Z,V as o,z as l,e as L,av as T,ad as y,$ as D,a0 as N,S as c,a1 as A,a2 as W,a3 as M,I as ee}from"./index.a1748043.js";import{a as te}from"./KtWidgetLayoutSkeleton.d2d36770.js";import{_ as ae}from"./KtWidgetLayoutStubSkeleton.vue_vue_type_style_index_0_lang.2b6c8a5f.js";import"./QSkeleton.d8507126.js";import{_ as h}from"./KtButton.5c4817ba.js";import"./KtIconSkeleton.6843b24f.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./KtWidgetLayoutText.4eb60d33.js";import"./QBtnDropdown.41a9457c.js";import"./QMenu.8a4718ad.js";import"./colors.85fc653d.js";const oe={class:"kt-about-me__editor-wrapper"},ne={class:"d-flex justify-center items-center q-gutter-md"},Ee=q({__name:"KtAboutMe",setup(se){const m=z(),{content:a,editor:g,editorId:U}=$(m),{CAN_EDIT:V}=$(J()),v=r(()=>`id${U.value}`),_=r(()=>{var e;return(e=a.value)!=null&&e.html?"read":"stub"}),G=r(()=>{var e;return((e=a.value)==null?void 0:e.additionalParams.POST.DETAIL_TEXT)||""}),x=r(()=>{const e=a.value,t=e==null?void 0:e.additionalParams.POST.UF_RENDERED;return t?{html:t.CONTENT,assets:{js:t.JS,css:t.CSS,string:[]}}:null}),H=r(()=>{const e=a.value,t=e==null?void 0:e.additionalParams.POST.UF;return t!=null&&t.UF_BLOG_POST_FILE?{UF_BLOG_POST_FILE:{USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_BLOG_POST_FILE[]",VALUE:t.UF_BLOG_POST_FILE.VALUE?[...t.UF_BLOG_POST_FILE.VALUE]:[]}}:{}}),n=i(_.value),s=i(),u=i(),f=i(!0),C=i(!1),p=e=>{n.value=e},E=()=>window.LHEPostForm||null,X=()=>{var e;return((e=E())==null?void 0:e.getEditor(v.value))||null},R=()=>{var e;return((e=E())==null?void 0:e.getHandler(v.value))||null},O=async()=>{f.value=!0,p("edit"),await m.loadEditor(),g.value&&(C.value?I():S(g.value,u.value).then(async()=>{C.value=!0,await ee();const e=window.BX,t=R();t&&(e.onCustomEvent(t.eventNode,"OnShowLHE",[!0]),I())}))},j=async()=>{const e=X();if(e===null)return!1;try{if(u.value){const t=window.BX,d=new FormData,P=t.ajax.prepareForm(u.value);d.append("data[text]",e.GetContent());for(const b in P.data)if(b){const B=`data[additionalData][${b}]`,k=P.data[b];Array.isArray(k)?k.forEach(Y=>{d.append(`${B}[]`,String(Y))}):d.append(B,k)}await m.send(d),p(_.value)}}catch{}},K=()=>{p(_.value)},I=()=>{var e;(e=E())==null||e.reinitData(v.value,G.value,H.value),f.value=!1};return Q([a,s],async()=>{s.value&&(a.value&&await S(a.value,s.value),x.value&&await S(x.value,s.value,!1))},{immediate:!0,deep:!0}),(e,t)=>(w(),F(o(te),{title:e.$t("aboutMe.title"),"padding-bottom":"30px",class:"kt-about-me"},Z({default:l(()=>[n.value==="stub"?(w(),F(o(ae),{key:0,icon:"kt:notebook",text:e.$t("aboutMe.description"),"btn-text":e.$t("aboutMe.btn"),onClick:O},null,8,["text","btn-text"])):D("",!0),N(c("div",{ref_key:"contentElement",ref:s,class:"kt-about-me__content"},null,512),[[A,n.value==="read"]]),N(c("div",oe,[f.value?(w(),F(W,{key:0})):D("",!0),t[0]||(M(-1),(t[0]=c("form",{ref_key:"editorElement",ref:u,class:"kt-about-me__editor"},null,512)).cacheIndex=0,M(1),t[0]),c("div",ne,[L(o(h),{theme:"primary",onClick:j},{default:l(()=>[T(y(e.$t("aboutMe.btnSave")),1)]),_:1}),L(o(h),{theme:"text",onClick:K},{default:l(()=>[T(y(e.$t("aboutMe.btnCancel")),1)]),_:1})])],512),[[A,n.value==="edit"]])]),_:2},[n.value==="read"&&o(V)?{name:"title-suffix",fn:l(()=>[L(o(h),{theme:"text",onClick:O},{default:l(()=>[T(y(e.$t("aboutMe.btnChange")),1)]),_:1})]),key:"0"}:void 0]),1032,["title"]))}});export{Ee as default};
