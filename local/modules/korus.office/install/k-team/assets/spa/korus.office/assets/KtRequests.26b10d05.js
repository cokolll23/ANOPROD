import{Q as G,a as A,b as J,c as x}from"./QTable.d6d4404d.js";import{a as W,Q as Y}from"./QItemLabel.b302d2e1.js";import{Q as Z}from"./QList.41df81dd.js";import{Q as ee}from"./QMenu.8a4718ad.js";import{L as D,r as z,c as U,bw as te,I as j,o as K,B as ae,w as le,x as c,R as V,S as Q,ad as _,y as g,z as n,av as k,$ as F,dS as ne,N as se,e as o,V as l,i as ie,F as B,U as $,ae as oe,a8 as re,a0 as ue,al as de}from"./index.a1748043.js";import{Q as X,a as ce}from"./QScrollArea.ec251a08.js";import{C as me}from"./ClosePopup.034ffd88.js";import{u as fe}from"./vue-i18n.esm-bundler.e5a16dbd.js";import{u as pe}from"./useTabs.f0639b31.js";import{u as he}from"./usePagination.17cd9769.js";import{_ as ye}from"./KtLink.5d7d273c.js";import{a as _e}from"./KtWidgetLayoutSkeleton.d2d36770.js";import{_ as be}from"./KtTabsSkeleton.7ddb9e75.js";import{_ as we}from"./KtSelect.f51478e4.js";import{_ as I}from"./KtUserCardSkeleton.a94624ce.js";import{_ as Ce}from"./KtPaginationSkeleton.vue_vue_type_style_index_0_lang.aba6d26a.js";import"./QSkeleton.d8507126.js";import"./QSelect.1740ff4d.js";import"./QChip.2708c0c7.js";import"./rtl.276c3f1b.js";import"./QTabs.a9c1b64a.js";import"./QResizeObserver.988c698f.js";import"./QScrollObserver.bf79761e.js";import"./touch.9135741d.js";import"./_commonjsHelpers.2cf1d77b.js";import"./KtIconSkeleton.6843b24f.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./QBadge.cb8db555.js";import"./QImg.7d3e6d1d.js";import"./QPagination.de182206.js";import"./index.43b0bc22.js";/*!
* Clamp.js 0.5.1
*
* Copyright 2011-2013, Joseph Schmitt http://joe.sh
* Released under the WTFPL license
* http://sam.zoy.org/wtfpl/
*/function xe(r,s){s=s||{};let u=window,i={clamp:s.clamp||2,useNativeClamp:typeof s.useNativeClamp!="undefined"?s.useNativeClamp:!0,splitOnChars:s.splitOnChars||[".","-","\u2013","\u2014"," "],animate:s.animate||!1,truncationChar:s.truncationChar||"\u2026",truncationHTML:s.truncationHTML},m=r.style,T=r.innerHTML,q=typeof r.style.webkitLineClamp!="undefined",d=i.clamp,v=d.indexOf&&(d.indexOf("px")>-1||d.indexOf("em")>-1),b;i.truncationHTML&&(b=document.createElement("span"),b.innerHTML=i.truncationHTML);function E(e,a){return u.getComputedStyle||(u.getComputedStyle=function(t,h){return this.el=t,this.getPropertyValue=function(y){let N=/(\-([a-z]){1})/g;return y=="float"&&(y="styleFloat"),N.test(y)&&(y=y.replace(N,function(){return arguments[2].toUpperCase()})),t.currentStyle&&t.currentStyle[y]?t.currentStyle[y]:null},this}),u.getComputedStyle(e,null).getPropertyValue(a)}function M(e){let a=e||r.clientHeight,t=w(r);return Math.max(Math.floor(a/t),0)}function R(e){return w(r)*e}function w(e){let a=E(e,"line-height");return a=="normal"&&(a=parseInt(E(e,"font-size"))*1.2),parseInt(a)}let C=i.splitOnChars.slice(0),p=C[0],f,P;function L(e){return e.lastChild&&e.lastChild.children&&e.lastChild.children.length>0?L(Array.prototype.slice.call(e.children).pop()):!e.lastChild||!e.lastChild.nodeValue||e.lastChild.nodeValue===""||e.lastChild.nodeValue===i.truncationChar?(e.lastChild.parentNode.removeChild(e.lastChild),L(r)):e.lastChild}function S(e,a){if(!a)return;function t(){C=i.splitOnChars.slice(0),p=C[0],f=null,P=null}let h=e.nodeValue.replace(i.truncationChar,"");if(f||(C.length>0?p=C.shift():p="",f=h.split(p)),f.length>1?(P=f.pop(),H(e,f.join(p))):f=null,b&&(e.nodeValue=e.nodeValue.replace(i.truncationChar,""),r.innerHTML=e.nodeValue+" "+b.innerHTML+i.truncationChar),f){if(r.clientHeight<=a)if(C.length>=0&&p!=="")H(e,f.join(p)+p+P),f=null;else return r.innerHTML}else p==""&&(H(e,""),e=L(r),t());if(i.animate)setTimeout(function(){S(e,a)},i.animate===!0?10:i.animate);else return S(e,a)}function H(e,a){e.nodeValue=a+i.truncationChar}d==="auto"?d=M():v&&(d=M(parseInt(d)));let O;if(q&&i.useNativeClamp)m.overflow="hidden",m.textOverflow="ellipsis",m.webkitBoxOrient="vertical",m.display="-webkit-box",m.webkitLineClamp=d,v&&(m.height=i.clamp+"px");else{let e=R(d);e<r.clientHeight&&(O=S(L(r),e))}return{original:T,clamped:O}}const ge=D({__name:"KtTextClamp",props:{text:{},maxLines:{default:1},showFullInTooltip:{type:Boolean,default:!1}},setup(r){const s=r,u=z(null),i=z("clamp"),m=z(s.text),T=z(!1),q=U(()=>s.showFullInTooltip&&T.value),d=()=>{m.value=s.text;const{clamped:b}=xe(u.value,{clamp:s.maxLines,useNativeClamp:!1});T.value=b!==void 0},v=te(async()=>{m.value=s.text,i.value=i.value==="clamp"?"_clamp":"clamp",await j(),d()},100);return K(()=>{d(),window.addEventListener("resize",v)}),ae(()=>{window.removeEventListener("resize",v)}),le(()=>[s.text,s.maxLines],d),(b,E)=>(c(),V("div",{class:"kt-text-clamp",key:i.value},[Q("div",{ref_key:"clampRef",ref:u,class:"kt-text-clamp__text"},_(m.value),513),q.value?(c(),g(X,{key:0,class:"kt-text-clamp__tooltip"},{default:n(()=>[k(_(s.text),1)]),_:1})):F("",!0)]))}});const ve={key:0,class:"kt-requests__table-comment"},ke={class:"full-width flex items-center q-mt-md"},Te={class:"kt-requests-per-page"},Le={class:"kt-requests-per-page__label"},Se=".js-requests-table",Ve=".js-requests-table-scroll",qe=10,ot=D({__name:"KtRequests",setup(r){const s=ne(),{t:u}=fe(),{activeTab:i}=pe(),{isFirstPage:m,isLastPage:T,totalPages:q,hasPagination:d,perPageOptions:v,prevPage:b,nextPage:E}=he(s),{tabs:M,list:R,nav:w}=se(s),C=[{name:"id",label:u("requests.table.id"),align:"left",field:"title",style:"min-width: 50px"},{name:"title",label:u("requests.table.title"),align:"left",field:"title",style:"min-width: 300px"},{name:"dateCreate",label:u("requests.table.dateCreate"),align:"left",field:"dateCreate",style:"min-width: 120px"},{name:"dateEnd",label:u("requests.table.dateEnd"),align:"left",field:"dateEnd",style:"min-width: 120px"},{name:"maxDeadline",label:u("requests.table.deadline"),align:"left",field:"maxDeadline",style:"min-width: 120px"},{name:"status",label:u("requests.table.status"),align:"left",field:"status",style:"min-width: 120px"},{name:"response",label:u("requests.table.executor"),align:"left",field:"response",style:"min-width: 200px"},{name:"comment",label:u("requests.table.comment"),align:"left",field:"comment",style:"min-width: 60px"}],p=window.BX,f={borderRadius:"4px"},P={height:"4px"},L=e=>({purple:"#9A77F7",blue:"#4589FF",green:"#24A148",red:"#FA4D56",yellow:"#FAC000",cyan:"#00A09B"})[e],S=()=>{const e=document.querySelector(Se),a=document.querySelector(Ve);if(e===null||a===null)return!1;a.style.height=e.offsetHeight+qe+"px"},H=e=>{p.SidePanel.Instance.open("/lk/request/detail.php?id="+e,{width:1e3,allowChangeHistory:!1,cacheable:!1,mobileFriendly:!0,events:{onLoad:function(a){document.body.style.overflow="hidden"},onClose:function(a){document.body.style.overflow="inherit"}}})},O=e=>{e.comment.new&&s.markCommentViewed(e.id)};return K(S),s.$onAction(({after:e,name:a})=>{if(a!=="load")return!1;e(async()=>{await j(),S()})}),(e,a)=>(c(),g(l(_e),{title:e.$t("requests.title"),class:"kt-requests"},{default:n(()=>[o(l(be),{modelValue:l(i),"onUpdate:modelValue":a[0]||(a[0]=t=>ie(i)?i.value=t:null),tabs:l(M)},null,8,["modelValue","tabs"]),o(ce,{visible:"","thumb-style":f,"horizontal-thumb-style":P,class:"kt-requests__scroll js-requests-table-scroll"},{default:n(()=>[o(G,{rows:l(R),columns:C,pagination:{rowsPerPage:U(()=>l(w).pageSize)},"row-key":"name","wrap-cells":"",separator:"horizontal",class:"js-requests-table","no-data-label":e.$t("requests.table.noData")},{header:n(t=>[o(A,{props:t},{default:n(()=>[(c(!0),V(B,null,$(t.cols,h=>(c(),g(J,{key:h.name,props:t,class:"text-uppercase"},{default:n(()=>[k(_(h.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:n(t=>[o(A,{props:t},{default:n(()=>[o(x,{key:"id",props:t},{default:n(()=>[k(_(t.row.id),1)]),_:2},1032,["props"]),o(x,{key:"title",props:t},{default:n(()=>[o(l(ye),{onClick:h=>H(t.row.id),theme:"secondary"},{default:n(()=>[o(l(ge),{text:t.row.title,"max-lines":2,"show-full-in-tooltip":""},null,8,["text"])]),_:2},1032,["onClick"])]),_:2},1032,["props"]),o(x,{key:"dateCreate",props:t},{default:n(()=>[k(_(t.row.dateCreate),1)]),_:2},1032,["props"]),o(x,{key:"dateEnd",props:t},{default:n(()=>[k(_(t.row.dateEnd),1)]),_:2},1032,["props"]),o(x,{key:"maxDeadline",props:t},{default:n(()=>[k(_(t.row.maxDeadline),1)]),_:2},1032,["props"]),o(x,{key:"status",props:t},{default:n(()=>[Q("span",{style:oe({color:L(t.row.status.color)})},_(t.row.status.text),5)]),_:2},1032,["props"]),o(x,{key:"response",props:t},{default:n(()=>[t.row.response.length>0?(c(),V(B,{key:0},[t.row.response.length===1?(c(!0),V(B,{key:0},$(t.row.response,(h,y)=>(c(),g(l(I),{key:y,user:h,size:"xs"},null,8,["user"]))),128)):(c(),g(re,{key:1,label:l(u)("requests.table.manyUser"),color:"primary"},{default:n(()=>[o(ee,null,{default:n(()=>[(c(!0),V(B,null,$(t.row.response,(h,y)=>(c(),g(Z,{key:y,dense:"",style:{"min-width":"100px"}},{default:n(()=>[ue((c(),g(W,{clickable:""},{default:n(()=>[o(Y,null,{default:n(()=>[o(l(I),{user:h,size:"xs"},null,8,["user"])]),_:2},1024)]),_:2},1024)),[[me]])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"]))],64)):F("",!0)]),_:2},1032,["props"]),o(x,{key:"comment",props:t},{default:n(()=>[t.row.comment.text?(c(),V("span",ve,[o(de,{name:"kt:chat-dots",color:t.row.comment.new?"secondary":"primary"},null,8,["color"]),o(X,{anchor:"bottom middle",self:"top middle",onShow:h=>O(t.row)},{default:n(()=>[k(_(t.row.comment.text),1)]),_:2},1032,["onShow"])])):F("",!0)]),_:2},1032,["props"])]),_:2},1032,["props"])]),bottom:n(()=>a[3]||(a[3]=[])),_:1},8,["rows","pagination","no-data-label"])]),_:1}),Q("div",ke,[l(d)?(c(),g(l(Ce),{key:0,modelValue:l(w).currentPage,"onUpdate:modelValue":a[1]||(a[1]=t=>l(w).currentPage=t),maxPage:l(q),"is-prev-disabled":l(m),"is-next-disabled":l(T),"prev-btn-handler":l(b),"next-btn-handler":l(E)},null,8,["modelValue","maxPage","is-prev-disabled","is-next-disabled","prev-btn-handler","next-btn-handler"])):F("",!0),Q("div",Te,[Q("div",Le,_(e.$t("pagination.perPage"))+": ",1),o(l(we),{modelValue:l(w).pageSize,"onUpdate:modelValue":a[2]||(a[2]=t=>l(w).pageSize=t),options:l(v)},null,8,["modelValue","options"])])])]),_:1},8,["title"]))}});export{ot as default};
