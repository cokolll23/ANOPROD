import{aL as d,K as l,c7 as _}from"./index.a1748043.js";import{y,s as A,t as f,z as I,A as T,r as N}from"./KtViewCounter.d7f8eb76.js";import L from"./KtContactEditMessengers.e7b8855c.js";import"./KtContactEditSettings.4c91d7b3.js";import"./KtContactEditTable.591645fc.js";import V from"./KtContactEditTimezone.e93666d7.js";import U from"./KtContactEditWorkplace.d7420246.js";import"./KtContactWorkplace.ee3f3fbb.js";import"./KtContactTable.6889acca.js";import"./KtContactTableSkeleton.50b3f49f.js";import"./KtContactVisibilitySwitcherBtn.03366610.js";var b=1,z=4;function E(a){return y(a,b|z)}const p={isMessenger(a){return a.name==="UF_MESSENGERS"&&Array.isArray(a.data.fieldInfo.SETTINGS)},isCheckbox(a){return a.data.fieldInfo.USER_TYPE_ID==="boolean"&&!Array.isArray(a.data.fieldInfo.SETTINGS)&&a.data.fieldInfo.SETTINGS.DISPLAY==="CHECKBOX"},isDate(a){return a.data.fieldInfo.USER_TYPE_ID==="date"},isEmployee(a){return a.data.fieldInfo.USER_TYPE_ID==="employee"||a.data.fieldInfo.USER_TYPE_ID==="user"},isWorkplace(a){return a.name==="UF_WORKPLACE"}};function S(a,s){const o=s.find(r=>String(r.VALUE)===String(a));return typeof o=="undefined"?"":o.NAME}function J(){const a=d(),s=[t=>t&&t.length>3||"\u041F\u043E\u043B\u0435 `Login` \u0434\u043E\u043B\u0436\u043D\u043E \u0431\u044B\u0442\u044C \u043D\u0435 \u043C\u0435\u043D\u044C\u0448\u0435 3-\u0445 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432!"],o=t=>{const e=a.$state[t.name];switch(t.type){case"datetime":{const n="d.m.Y",u=new Date(e).getTime()/1e3,g=!e||Number.isNaN(new Date(e))?null:BX.date.format(n,u);return{value:g,valueInitial:E(g),[Symbol.toStringTag]:"datetime"}}case"list":{const n={VALUE:e,NAME:S(e,t.data.items)};return{value:n,valueInitial:E(n),[Symbol.toStringTag]:"list"}}case"multilist":{const n=e.map(u=>({VALUE:u,NAME:S(u,t.data.items)}));return{value:n,valueInitial:E(n),[Symbol.toStringTag]:"multilist"}}case"timezone":{const n={timezoneValue:{VALUE:e,NAME:S(e,t.data.timezone_items)},timezoneValueAuto:{VALUE:a.$state.AUTO_TIME_ZONE,NAME:S(a.$state.AUTO_TIME_ZONE,t.data.auto_timezone_items)}};return{value:n,valueInitial:E(n),[Symbol.toStringTag]:"timezone"}}case"userField":{let n,u="text";switch(t.data.fieldInfo.USER_TYPE_ID){case"integer":n=typeof e=="number"?e:null;break;case"boolean":n=Boolean(e);break;case"date":{const m="d.m.Y",g=new Date(e).getTime()/1e3;n=!e||Number.isNaN(new Date(e))?BX.date.format(m,g):null,u="datetime";break}case"employee":{t.data.fieldInfo.MULTIPLE==="Y"?n=e?e.map(m=>m.ID):[]:n=e?e.ID:null;break}case"messengers":{n=e?e.map(m=>({VALUE:m.value,NAME:m.messenger,[m.messenger]:m.value})):[],u="messengers";break}default:n=typeof e=="string"?e:""}return{value:n,valueInitial:E(n),[Symbol.toStringTag]:u}}default:{const n=e!=null?e:"";return{value:n,valueInitial:E(n),[Symbol.toStringTag]:"text"}}}};function r(t){let e=a.$state[t.name];switch(t.type){case"userField":return t.data.fieldInfo.USER_TYPE_ID==="employee"?t.data.fieldInfo.MULTIPLE==="Y"?e=e?e.map(n=>["user",n.ID]):[["user",""]]:e=e?[["user",e.ID]]:[["user",""]]:e=typeof e=="string"?e:"",{preselectedValue:e};default:return{preselectedValue:e!=null?e:""}}}function i(t){switch(t.type){case"list":case"multilist":return l(N);case"datetime":return l(I);case"timezone":return l(V);case"userField":return p.isMessenger(t)?l(L):p.isCheckbox(t)?l(f):p.isDate(t)?l(I):p.isEmployee(t)?l(T):p.isWorkplace(t)?l(U):l(A);default:return l(A)}}function c(t){const e=Object.create(null),n=["NAME","LAST_NAME","SECOND_NAME"];switch(t.type){case"text":case"link":case"datetime":case"phone":e.modelValue=t.value,e["onUpdate:modelValue"]=u=>{t.value=u},n.includes(t.name)&&(e.disable=!0),t.name==="LOGIN"?(e.rules=s,e.lazyRules=!0):t.name==="EMAIL"&&(e.rules=["email"],e.lazyRules=!0,e.errorMessage="\u041F\u043E\u043B\u0435 `Email` \u0443\u043A\u0430\u0437\u0430\u043D\u043E \u0432 \u043D\u0435\u0432\u0435\u0440\u043D\u043E\u043C \u0444\u043E\u0440\u043C\u0430\u0442\u0435!");break;case"list":case"multilist":e.modelValue=t.value,e["onUpdate:modelValue"]=u=>{t.value=u},e.optionValue="VALUE",e.optionLabel="NAME",e.options=t.data.items,e.multiple=t.type==="multilist",e.hideBottomSpace=!0;break;case"timezone":e.timezone=t.value.timezoneValue,e.timezoneAuto=t.value.timezoneValueAuto,e.timezoneItems=t.data.timezone_items,e.timezoneItemsAuto=t.data.auto_timezone_items,e["onUpdate:timezone"]=u=>{t.value.timezoneValue=u},e["onUpdate:timezoneAuto"]=u=>{t.value.timezoneValueAuto=u};break;case"userField":e.modelValue=t.value,e["onUpdate:modelValue"]=u=>{t.value=u},t.name==="UF_MESSENGERS"&&Array.isArray(t.data.fieldInfo.SETTINGS)&&(e.options=t.data.fieldInfo.SETTINGS.map(u=>({NAME:u.code,VALUE:u.value})),e.multiple=!0),p.isEmployee(t)&&(e.id=t.name,e.entities=[{id:"user"}],e.preselectedItems=t.preselectedValue,e.multiple=t.data.fieldInfo.MULTIPLE==="Y",e.targetElement=null,e.showPopupByFieldClick=!0,e.showDropdownIcon=!0,e.showActionMoreBtn=e.multiple,e.hideBottomSpace=!0),t.data.fieldInfo.USER_TYPE_ID==="integer"&&(e.type="number");break}return e}return{getComponentValue:o,getComponentPreselectedValue:r,getComponentName:i,getComponentProps:c}}const C=(a,s)=>a!==s?a:null,M=(a,s)=>JSON.stringify(a)!==JSON.stringify(s)?a.map(o=>({value:o[o.NAME],messenger:o.NAME})):null,v=(a,s)=>a.VALUE!==s.VALUE?a.VALUE:null,D=(a,s)=>{const o=a.map(i=>i.VALUE),r=s.map(i=>i.VALUE);return JSON.stringify(o)!==JSON.stringify(r)?o:null},h=(a,s)=>{var o,r,i;return((o=a.timezoneValue)==null?void 0:o.VALUE)!==((r=s.timezoneValue)==null?void 0:r.VALUE)||a.timezoneValueAuto.VALUE!==s.timezoneValueAuto.VALUE?{AUTO_TIME_ZONE:String(a.timezoneValueAuto.VALUE),TIME_ZONE:String((i=a.timezoneValue)==null?void 0:i.VALUE)}:null};function W(){return{getChangedFields(a){let s=-1;const o=[];for(;++s<a.length;){let r=null;const{name:i,value:c,valueInitial:t}=a[s];switch(_(a[s])){case"timezone":r=h(c,t);break;case"messengers":r=M(c,t);break;case"list":r=v(c,t);break;case"multilist":r=D(c,t);break;default:r=C(c,t)}r!==null&&o.push({name:i,changes:r,[Symbol.toStringTag]:a[s][Symbol.toStringTag]})}return o}}}export{W as a,E as c,J as u};
