import{L as te,N as P,Y as ue,M as oe,aM as le,r as s,c as se,x as u,R as f,e as n,z as d,S as v,F as O,U as T,y as g,V as o,ag as R,a8 as Q,ac as h,i as ne,av as c,ad as E,$ as j,ab as L,aD as re,c7 as ie}from"./index.a1748043.js";import{Q as de}from"./KtViewCounter.d7f8eb76.js";import{v as Y}from"./KtContactEditTable.591645fc.js";import{u as me,a as pe}from"./useChanges.ef424401.js";import{_ as Z}from"./KtButton.5c4817ba.js";import y from"./KtPersonalInfoEditField.0e03ac4d.js";import"./QBadge.cb8db555.js";import"./vue-i18n.esm-bundler.e5a16dbd.js";import"./index.2f026771.js";import"./QBtnDropdown.41a9457c.js";import"./QMenu.8a4718ad.js";import"./QDate.59abae0b.js";import"./use-render-cache.3aae9b27.js";import"./ClosePopup.034ffd88.js";import"./QScrollArea.ec251a08.js";import"./QResizeObserver.988c698f.js";import"./QScrollObserver.bf79761e.js";import"./touch.9135741d.js";import"./QItemLabel.b302d2e1.js";import"./QTabs.a9c1b64a.js";import"./rtl.276c3f1b.js";import"./QExpansionItem.ec578cd9.js";import"./QImg.7d3e6d1d.js";import"./IndexPage.75cfb3f1.js";import"./QPagination.de182206.js";import"./QSelect.1740ff4d.js";import"./QChip.2708c0c7.js";import"./QSkeleton.d8507126.js";import"./QTabPanels.aa3c86a4.js";import"./index.43b0bc22.js";import"./_commonjsHelpers.2cf1d77b.js";import"./KtContactEditMessengers.e7b8855c.js";import"./KtContactEditSettings.4c91d7b3.js";import"./KtContactEditTimezone.e93666d7.js";import"./KtContactEditWorkplace.d7420246.js";import"./plugin-vue_export-helper.21dcd24c.js";import"./KtContactWorkplace.ee3f3fbb.js";import"./KtContactTable.6889acca.js";import"./KtContactTableSkeleton.50b3f49f.js";import"./KtContactVisibilitySwitcherBtn.03366610.js";import"./colors.85fc653d.js";import"./KtWidgetLayoutRow.7ad5d39d.js";import"./KtWidgetLayoutText.4eb60d33.js";import"./KtSelect.f51478e4.js";import"./QPopupProxy.64a89f3e.js";const fe={class:"kt-personal-info-edit-mode"},ve={key:4},ge={class:"kt-personal-info-edit-mode__actions"},ra=te({__name:"KtPersonalInfoEditMode",emits:["change-mode"],setup(ce,{emit:z}){const{SHOW_SONET_ADMIN:k,SORT_DISABLE:m}=P(ue()),K=oe(),q=z,$=le(),I=s(!1),{FIELDS_EDITABLE:H}=P($),b=s(!1),M=se(()=>({animation:150,disabled:!1}));s([]);const _=s(!1),C=s(!1),{getComponentValue:W,getComponentPreselectedValue:G}=me(),{getChangedFields:A}=pe(),r=s([]),F=s([]),i=s([]),J=["NAME","LAST_NAME","SECOND_NAME"],N=function(t,e){return t.sort.value>e.sort.value?1:t.sort.value<e.sort.value?-1:0},U=()=>{H.value.forEach(t=>{const e=Object.assign(t,W(t),G(t));t.sort.type==="M"&&(J.indexOf(t.name)!==-1?F.value.push(e):r.value.push(e)),t.sort.type==="A"&&i.value.push(e)}),r.value.sort(N),F.value.sort(N),i.value.sort(N)},B=s(null),D=s(!0),X=t=>{const e=new FormData;return r.value.forEach((a,l)=>{e.set(`sortSettings[main][${a.name}]`,String(l))}),i.value.forEach((a,l)=>{e.set(`sortSettings[additional][${a.name}]`,String(l))}),e.set("sortSettings[disableSort]",m.value?"Y":"N"),e.set("sortSettings[setFromDefault]",_.value?"Y":"N"),e.set("sortSettings[updateDefault]",C.value?"Y":"N"),re(t)||t.forEach(a=>{const l=`data[${a.name}]`,p=a.changes;switch(ie(a)){case"messengers":p.length>0?p.forEach((S,V)=>{const ee=`${l}[${V}][messenger]`,ae=`${l}[${V}][value]`;e.append(ee,S.messenger),e.append(ae,S.value)}):e.set(`${l}[]`,"");break;case"timezone":e.set("data[AUTO_TIME_ZONE]",p.AUTO_TIME_ZONE),e.set("data[TIME_ZONE]",p.TIME_ZONE);break;case"list":e.set(l,p);break;case"multilist":p.forEach((S,V)=>{e.append(`${l}[${V}]`,String(S))});break;default:e.set(l,p)}}),e},w=()=>{var t;q("change-mode","read"),window.scrollTo(0,0),r.value.forEach(e=>{e.value=e.valueInitial!==null&&typeof e.valueInitial=="object"?L(!0,Array.isArray(e.valueInitial)?[]:{},e.valueInitial):e.valueInitial}),i.value.forEach(e=>{e.value=e.valueInitial!==null&&typeof e.valueInitial=="object"?L(!0,Array.isArray(e.valueInitial)?[]:{},e.valueInitial):e.valueInitial}),(t=B.value)==null||t.resetValidation(),D.value=!0},x=async()=>{var e;if(D.value=Boolean(await((e=B.value)==null?void 0:e.validate())),!D.value)return K.notify({type:"negative",message:"\u041F\u0440\u043E\u0432\u0435\u0440\u044C\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E\u0441\u0442\u044C \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044F \u043F\u043E\u043B\u0435\u0439",position:"top"}),!1;const t=A(r.value).concat(A(i.value)).concat(A(F.value));I.value=!0,await $.submit(X(t)),I.value=!1,w()};return U(),$.$onAction(({after:t,name:e})=>{if(e!=="submit")return!1;t(U)}),(t,e)=>(u(),f("div",fe,[n(o(de),{ref_key:"editFormRef",ref:B,onSubmit:x},{default:d(()=>[e[10]||(e[10]=v("div",null,[v("h6",null,"\u041E\u0441\u043D\u043E\u0432\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F:")],-1)),(u(!0),f(O,null,T(F.value,a=>(u(),g(y,{key:a.name,field:a},null,8,["field"]))),128)),!o(m)||o(k)?(u(),g(o(Y),R({key:0,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a)},M.value,{"item-key":"name",group:"a",handle:".draggable-handle-icon",onStart:e[1]||(e[1]=a=>b.value=!0),onEnd:e[2]||(e[2]=a=>b.value=!1)}),{item:d(({element:a})=>[(u(),f("div",{key:a.name},[n(Q,{flat:"",padding:"none",icon:"drag_indicator",class:"draggable-handle-icon"}),n(y,{field:a},null,8,["field"])]))]),_:1},16,["modelValue"])):(u(!0),f(O,{key:1},T(r.value,a=>(u(),g(y,{key:a.name,field:a},null,8,["field"]))),128)),e[11]||(e[11]=v("div",null,[v("h6",null,"\u0414\u043E\u043F\u043E\u043B\u043D\u0438\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0438\u043D\u0444\u043E\u0440\u043C\u0430\u0446\u0438\u044F:")],-1)),!o(m)||o(k)?(u(),g(o(Y),R({key:2,modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value=a)},M.value,{handle:".draggable-handle-icon","item-key":"name",group:"a",onStart:e[4]||(e[4]=a=>b.value=!0),onEnd:e[5]||(e[5]=a=>b.value=!1)}),{item:d(({element:a})=>[(u(),f("div",{key:a.name},[n(Q,{flat:"",padding:"none",icon:"drag_indicator",class:"draggable-handle-icon"}),n(y,{field:a},null,8,["field"])]))]),_:1},16,["modelValue"])):(u(!0),f(O,{key:3},T(i.value,a=>(u(),g(y,{key:a.name,field:a},null,8,["field"]))),128)),o(k)?(u(),f("div",ve,[e[9]||(e[9]=v("h6",null,"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u043E\u0440\u0442\u0438\u0440\u043E\u0432\u043A\u043E\u0439 \u043F\u043E\u043B\u0435\u0439:",-1)),n(h,{modelValue:o(m),"onUpdate:modelValue":e[6]||(e[6]=a=>ne(m)?m.value=a:null)},{default:d(()=>[c(E(t.$t("personalInfoEdit.checkboxes.disableSort")),1)]),_:1},8,["modelValue"]),!o(m)||o(k)?(u(),g(h,{key:0,modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a)},{default:d(()=>[c(E(t.$t("personalInfoEdit.checkboxes.setFromDefault")),1)]),_:1},8,["modelValue"])):j("",!0),n(h,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=a=>C.value=a)},{default:d(()=>[c(E(t.$t("personalInfoEdit.checkboxes.updateDefault")),1)]),_:1},8,["modelValue"])])):j("",!0),v("div",ge,[n(o(Z),{theme:"primary",loading:I.value,disable:!D.value,onClick:x},{default:d(()=>[c(E(t.$t("personalInfoEdit.btnSave")),1)]),_:1},8,["loading","disable"]),n(o(Z),{onClick:w},{default:d(()=>[c(E(t.$t("personalInfoEdit.btnCancel")),1)]),_:1})])]),_:1},512)]))}});export{ra as default};
